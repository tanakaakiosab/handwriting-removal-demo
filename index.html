<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>OCR連携手書き文字除去アプリ</title>
  <style>
    /* スタイルは省略（前回の長いCSSをそのまま使用） */
    /* 上記ファイルのスタイル全体をここに貼り付けてください */
  </style>
</head>
<body>
  <div class="container">
    <h1>🤖 OCR連携手書き文字除去アプリ</h1>

    <div class="method-info">
      <h3>🎯 処理の流れ</h3>
      <ul>
        <li><strong>Step 1:</strong> 画像を選択</li>
        <li><strong>Step 2:</strong> Tesseract.jsでOCR解析 → 印刷文字領域を特定</li>
        <li><strong>Step 3:</strong> 手書き文字だけを抽出し、マスクを作成</li>
        <li><strong>Step 4:</strong> OpenCV.jsでインペインティング処理</li>
        <li><strong>Step 5:</strong> 結果を保存または確認</li>
      </ul>
    </div>

    <div id="status" class="status loading">Tesseract.js を読み込み中...</div>
    <div class="progress-section" id="progressSection" style="display: none;">
      <div class="progress-text" id="progressText">処理中...</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div id="controls">
      <input type="file" id="inputImage" accept="image/*" disabled />
      <div class="language-selector">
        <label for="languageSelect">OCR言語: </label>
        <select id="languageSelect" disabled>
          <option value="jpn+eng">日本語+英語</option>
          <option value="eng">英語のみ</option>
          <option value="jpn">日本語のみ</option>
        </select>
      </div>
      <button id="ocrBtn" disabled>🔍 OCR解析実行</button>
      <button id="processBtn" disabled>🖍️ 手書き除去</button>
      <button id="saveBtn" disabled>💾 結果を保存</button>
    </div>

    <div class="parameter-controls">
      <div class="parameter-group">
        <label for="confidenceThreshold">OCR信頼度閾値</label>
        <input type="range" id="confidenceThreshold" min="10" max="90" value="50" disabled />
        <div class="value-display" id="confidenceValue">50%</div>
        <small>この値以下の認識結果を手書きとみなす</small>
      </div>
      <div class="parameter-group">
        <label for="expansionSize">マスク拡張サイズ</label>
        <input type="range" id="expansionSize" min="1" max="20" value="5" disabled />
        <div class="value-display" id="expansionValue">5px</div>
        <small>手書き領域を少し広げて確実に除去</small>
      </div>
      <div class="parameter-group">
        <label for="inpaintRadius">修復範囲</label>
        <input type="range" id="inpaintRadius" min="3" max="15" value="7" disabled />
        <div class="value-display" id="inpaintValue">7px</div>
        <small>インペインティングの修復範囲</small>
      </div>
      <div class="parameter-group">
        <label for="minTextSize">最小文字サイズ</label>
        <input type="range" id="minTextSize" min="5" max="50" value="15" disabled />
        <div class="value-display" id="minSizeValue">15px</div>
        <small>この値以下のテキストは除去対象</small>
      </div>
    </div>

    <div class="canvas-section">
      <h3>📷 元画像</h3>
      <canvas id="canvasInput"></canvas>
    </div>

    <div class="ocr-results" id="ocrResults" style="display: none;">
      <h4>🔍 OCR解析結果</h4>
      <div id="ocrText"></div>
    </div>

    <div class="canvas-section">
      <h3>🎯 OCR検出結果（緑=印刷文字、赤=手書き文字）</h3>
      <canvas id="ocrCanvas"></canvas>
    </div>

    <div class="canvas-section">
      <h3>🖍️ 手書き文字マスク（除去対象）</h3>
      <canvas id="maskCanvas"></canvas>
    </div>

    <div class="canvas-section">
      <h3>✨ 最終結果（手書き文字除去後）</h3>
      <canvas id="canvasOutput"></canvas>
    </div>

    <canvas id="hiddenCanvas" style="display:none;"></canvas>
  </div>

  <!-- 必須ライブラリ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script> 
  <script async src="https://docs.opencv.org/4.x/opencv.js"  onload="onOpenCvReady();"></script>

  <!-- JavaScript処理 -->
  <script>
    // ここに前回の `<script>` 内容をそのまま貼り付け
    // （長いJavaScript部分も含めて）
  </script>
</body>
</html>
